version: '3.8'
services:
web:
build: .
container_name: recipes_web
ports:
- "8000:8000"
environment:
- DATABASE_URL=postgresql://postgres:postgres@db:5432/recipes
- REDIS_URL=redis://redis:6379/0
- SECRET_KEY=supersecret_dev_key
- RATE_LIMITS=100/hour
depends_on:
- db
- redis
restart: unless-stopped

db:
image: postgres:15-alpine
container_name: recipes_db
environment:
POSTGRES_USER: postgres
POSTGRES_PASSWORD: postgres
POSTGRES_DB: recipes
volumes:
- db_data:/var/lib/postgresql/data
ports:
- "5432:5432"

redis:
image: redis:7-alpine
container_name: recipes_redis
ports:
- "6379:6379"

worker:
build: .
command: python -u worker.py
environment:
- DATABASE_URL=postgresql://postgres:postgres@db:5432/recipes
- REDIS_URL=redis://redis:6379/0
- SECRET_KEY=supersecret_dev_key
depends_on:
- db
- redis
restart: unless-stopped

volumes:
db_data: